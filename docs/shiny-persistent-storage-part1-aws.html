<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Cloud Services for Persistent Storage for Shiny Apps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="shiny-persistent-storage-part1-aws_files/libs/clipboard/clipboard.min.js"></script>
<script src="shiny-persistent-storage-part1-aws_files/libs/quarto-html/quarto.js"></script>
<script src="shiny-persistent-storage-part1-aws_files/libs/quarto-html/popper.min.js"></script>
<script src="shiny-persistent-storage-part1-aws_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="shiny-persistent-storage-part1-aws_files/libs/quarto-html/anchor.min.js"></script>
<link href="shiny-persistent-storage-part1-aws_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="shiny-persistent-storage-part1-aws_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="shiny-persistent-storage-part1-aws_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="shiny-persistent-storage-part1-aws_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="shiny-persistent-storage-part1-aws_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<!-- Global site tag (gtag.js) - Google Analytics -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-WFBV8LKRHQ"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-WFBV8LKRHQ');

</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#using-cloud-storage-in-your-shiny-app-safely" id="toc-using-cloud-storage-in-your-shiny-app-safely" class="nav-link" data-scroll-target="#using-cloud-storage-in-your-shiny-app-safely">Using Cloud Storage in your Shiny App <em>Safely</em></a>
  <ul class="collapse">
  <li><a href="#create-service-accounts" id="toc-create-service-accounts" class="nav-link" data-scroll-target="#create-service-accounts">1. Create Service Accounts</a></li>
  <li><a href="#use-temporary-credentials" id="toc-use-temporary-credentials" class="nav-link" data-scroll-target="#use-temporary-credentials">2. Use temporary credentials</a></li>
  <li><a href="#limit-permissions" id="toc-limit-permissions" class="nav-link" data-scroll-target="#limit-permissions">3. Limit Permissions</a></li>
  <li><a href="#keep-your-credentials-away-from-your-code" id="toc-keep-your-credentials-away-from-your-code" class="nav-link" data-scroll-target="#keep-your-credentials-away-from-your-code">4. Keep Your Credentials Away from Your Code</a></li>
  </ul></li>
  <li><a href="#configuring-aws-s3" id="toc-configuring-aws-s3" class="nav-link" data-scroll-target="#configuring-aws-s3">Configuring AWS S3</a>
  <ul class="collapse">
  <li><a href="#create-a-new-s3-bucket" id="toc-create-a-new-s3-bucket" class="nav-link" data-scroll-target="#create-a-new-s3-bucket">1. Create a new S3 Bucket</a></li>
  <li><a href="#create-folders-in-your-bucket-optional" id="toc-create-folders-in-your-bucket-optional" class="nav-link" data-scroll-target="#create-folders-in-your-bucket-optional">2. Create Folders in Your Bucket (optional)</a></li>
  <li><a href="#make-one-of-the-folders-public" id="toc-make-one-of-the-folders-public" class="nav-link" data-scroll-target="#make-one-of-the-folders-public">3. Make One of the Folders Public</a></li>
  <li><a href="#create-an-iam-user" id="toc-create-an-iam-user" class="nav-link" data-scroll-target="#create-an-iam-user">4. Create an IAM User</a></li>
  <li><a href="#give-the-iam-user-permissions-to-your-bucket" id="toc-give-the-iam-user-permissions-to-your-bucket" class="nav-link" data-scroll-target="#give-the-iam-user-permissions-to-your-bucket">5. Give the IAM User permissions to your bucket</a></li>
  <li><a href="#create-security-credentials" id="toc-create-security-credentials" class="nav-link" data-scroll-target="#create-security-credentials">6. Create Security Credentials</a></li>
  </ul></li>
  <li><a href="#transfer-files-tofrom-s3-from-r" id="toc-transfer-files-tofrom-s3-from-r" class="nav-link" data-scroll-target="#transfer-files-tofrom-s3-from-r">Transfer Files To/From S3 from R</a>
  <ul class="collapse">
  <li><a href="#load-credentials" id="toc-load-credentials" class="nav-link" data-scroll-target="#load-credentials">Load Credentials</a></li>
  <li><a href="#check-bucket" id="toc-check-bucket" class="nav-link" data-scroll-target="#check-bucket">Check Bucket</a></li>
  <li><a href="#download-and-upload-files" id="toc-download-and-upload-files" class="nav-link" data-scroll-target="#download-and-upload-files">Download and Upload Files</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">
<div style="background-color:#1C2C53; color:white; padding:8px;">

<img src="images/ucanr_2019_white_232x30.png" style="width:232px; height:30px; margin:15px;"><a href="http://igis.ucanr.edu/">

<img src="images/igis-shield_54x54.png" style="width:54px; height:54px; margin:4px; float:right;"></a>

</div>

<div style="clear:both;"></div>




<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Cloud Services for Persistent Storage for Shiny Apps</h1>
<p class="subtitle lead">Part 1: AWS S3</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
h1.title {
  font-family: Muli, "Open Sans", sans-serif;
  font-weight:600; 
  font-size:2.5rem; 
  border-top-color: rgb(237, 169, 31);
  border-top-width: 5px;
  border-top-style: solid;
  margin-top:0.5em;
  line-height:1.5;
  
}
p.subtitle {
  font-family: Muli, "Open Sans", sans-serif;
  font-size:2rem;
  font-weight:500; 
}
h2 {
  font-size:2rem;
  font-weight:500; 
  font-family:Muli,"Open Sans",sans-serif;
}
h3 {font-size:1.5rem; font-weight:500;}
h4.date,h4.author {font-size:100%;}
div.protip {padding:0.5em; background-color:#ddd; border:2px solid gray; margin:0 3em;}

div.about-technotes {
  font-style:italic; 
  font-size:90%; 
  margin:2em;
}
div.author {
  font-size:90%; 
}
img.screenshot, div.json-chunk {
  border:1px solid gray;
}
</style>
</div>
<hr>
<div class="author">
<p><a href="https://ucanr.edu/?facultyid=32909">Andy Lyons</a><br>
January, 2024</p>
</div>
<div class="about-technotes">
<p>IGIS <a href="http://igis.ucanr.edu/Tech_Notes/">Tech Notes</a> describe workflows and techniques for using geospatial science and technologies in research and extension. They are works in progress, and we welcome feedback and comments.</p>
</div>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>When you publish a Shiny app to ShinyApps.io or another hosting platform, you may or may not have the ability to store data on the server between sessions. If you need persistent storage, you can turn to cloud storage services such as Google Cloud or AWS s3. This Tech Note describes how your R projects can work with cloud services safely and securely, and the specific steps for setting up S3 to store data.</p>
<p><br>
</p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p><a href="https://www.shinyapps.io/">ShinyApps.io</a> is a great platform from Posit for hosting Shiny apps, but it has one major drawback - the lack of persistent storage. Persistent storage refers to the ability of your app to save data more or less ‘permanently’, so that it can be read by future sessions of your Shiny App, or other programming tools.</p>
<p>Persistent storage often isn’t needed for Shiny apps, but it’s essential if:</p>
<ol type="1">
<li>The purpose of your Shiny app is to collect data from users (e.g., a glorified Google Form)<br>
</li>
<li>The app requires data created in previous sessions<br>
</li>
<li>Your app creates a custom log that you want to save to disk for analysis</li>
</ol>
<p>Persistent storage isn’t available on platforms like ShinyApps.io which essentially fires up a brand new session of your Shiny app every time someone connects to it. This means the only files you can count on being available are those that you uploaded when you published your app.</p>
<p>Fear not however! This Tech Note describes how you can “wire-in” storage from Google Drive or AWS S3 to a Shiny App hosted on ShinyApps.io. Note that what we are discussing here is saving <em>files</em> to Google Drive or S3. If the data you want to save is structured and lends itself to being stored in a database, see the excellent blog post by Dean Attali <a href="https://shiny.posit.co/r/articles/build/persistent-data-storage/">Persistent data storage in Shiny apps</a>.</p>
<p><br>
</p>
</section>
<section id="using-cloud-storage-in-your-shiny-app-safely" class="level2">
<h2 class="anchored" data-anchor-id="using-cloud-storage-in-your-shiny-app-safely">Using Cloud Storage in your Shiny App <em>Safely</em></h2>
<p>Whether you’re working with Google Drive, AWS, or some other cloud storage provider, you’ll most likely have to write code to authenticate with the provider before you can do anything else. You could in theory authenticate with your Google username and password, but this would be a horrible idea. If someone got a hold of your code, they could not only upload and download files to your Google Drive, they could also potentially get into your Gmail, Google Docs, and anything else you do with Google. The same is true with AWS, DropBox, and other cloud services.</p>
<p>How do web app developers deal with this? Fortunately, companies like Amazon and Google have put a lot of effort into best practices for making data transfers with web apps safe and secure. Although there is no way to completely eliminate all risks, following these practices will significantly reduce the likelihood of credentials getting loose, and greatly mitigate the consequences in case someone gets access to your credentials.</p>
<p>There are four general strategies that you can use:</p>
<ol type="1">
<li>Use service accounts (so you don’t give away the kitchen sink)<br>
</li>
<li>Use temporary credentials<br>
</li>
<li>Assign the absolute minimum level of permissions needed (to contain the damage from a leak)<br>
</li>
<li>Don’t put credentials in code or version control</li>
</ol>
<section id="create-service-accounts" class="level3">
<h3 class="anchored" data-anchor-id="create-service-accounts">1. Create Service Accounts</h3>
<p>Service accounts (also called IAM accounts in the AWS universe) can be thought of as “sub-accounts” of your main Google or Amazon account. Just like your main account, they’ll have the equivalent of a username and password (although these might be called other things, like token, public and private keys, etc.). However unlike your main account, you only give them access to very specific things (like storage services). Thus even if someone got the credentials for the service account, they couldn’t get into anything the service account wasn’t provisioned with.</p>
</section>
<section id="use-temporary-credentials" class="level3">
<h3 class="anchored" data-anchor-id="use-temporary-credentials">2. Use temporary credentials</h3>
<p>Some cloud service have the option (or may even require) authenticating with a temporary token instead of service account credentials to access the platform. In a Shiny app, this probably means your “preamble” code in app.R would pass your service account credentials to an API, and get back a token that might be valid for only two hours. You then use that token when making subsequent calls in the session.</p>
</section>
<section id="limit-permissions" class="level3">
<h3 class="anchored" data-anchor-id="limit-permissions">3. Limit Permissions</h3>
<p>The Googles and AWSs of the world have dozens of cloud services (e.g., Google has Google Drive, Google Docs, Google Static Maps, Google Cloud Compute, etc.). When you create a service account, you typically have to specify which service(s) it has access to. The general rule of thumb is to only give the service account only those permissions that it will need for your Shiny app. If you need additional or different services for another R project, you simply create additional service accounts.</p>
<p>Depending on the platform and the service, you can dial in permissions even further. AWS has extremely fine grained permissions across all of their services, including S3. For example if all you need is for your Shiny app to upload a log file at the end of the session, you can give the IAM account permission to save files to one and only folder, in one and only one S3 bucket, with no read permissions at all. That way even if someone hijacked the service account, all they could do is upload files, and not see anything that is already there.</p>
</section>
<section id="keep-your-credentials-away-from-your-code" class="level3">
<h3 class="anchored" data-anchor-id="keep-your-credentials-away-from-your-code">4. Keep Your Credentials Away from Your Code</h3>
<p>It should be no surprise that putting your passwords in your code is a bad idea (although we’ve all done it!). If you’re working on your laptop or a server that you control, a common best practice is to store your passwords as environment variables (i.e., in your <code>.Renviron</code> file), and bring them into your script via <code>Sys.getenv()</code>. For stronger security, you can use a package like <a href="https://cran.r-project.org/web/packages/keyring/index.html"><code>keyring</code></a> that has functions to save credentials within the operating system. Another option is to store your credentials in an external file, such as a JSON or text file. This last one is in fact is what we have to use for publishing a Shiny app on ShinyApps.io, as described below.</p>
<p>Keeping your credentials out of your code allows you to safely use version control and share you code with colleagues (two other best practices). But this requires you take precautions that they don’t accidentally get “checked in” to a version control system (i.e.&nbsp;GitHub). This kind of unintentional escape is actually far more common than malicious hackers breaking into your server. To prevent credentials from being saved to GitHub, you need to either keep then out from the project folder, or configure your version control system to ensure they don’t get checked-in.</p>
<p><br>
</p>
<div class="callout callout-style-default callout-tip callout-titled" title="A Solution for Saving Credentials for a Shiny App">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A Solution for Saving Credentials for a Shiny App
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the case of a Shiny app on ShinyApps.io, credentials do in fact need to be included among the files you upload when you publish the app. This is because ShinyApps.io doesn’t allow you to set up environment variables on the server (in part because you’re not using your own dedicated server but rather a VM running on a shared server). Other hosting services may allow you to set up environment variables, which you should definitely take advantage of when available.</p>
<p>For ShinyApps.io, we’ll do the next best thing which is to put the credentials in an external file. What that file looks like and how we create it depends on the platform (see below). This will allow us to check our code into GitHub, as long as we don’t don’t check in the credentials file. You can request Git to not check-in certain files by adding them to a file called <code>.gitignore</code>. Every repo (i.e., directory) can (and should) have its own <code>.gitignore</code> file.</p>
<p>A suggested practice is to create a subdirectory within your Shiny project directory called <code>.secrets</code>, and add that to <code>.gitignore</code>. Then you can just dump all your credential files in there and not have to worry about what their file names are, because everything in that folder will be excluded from GitHub. You then import the credentials into <code>app.R</code> with some kind of read function (e.g., <code>readLines()</code>, <code>readRDS()</code>, <code>jsonlite::read_json()</code>). And of course the <code>.secrets</code> folder and all its contents also need to be uploaded to ShinyApps.io when you publish your app.</p>
<p>Just remember to add the <code>.secrets</code> folder to <code>.gitignore</code> <em>before</em> you make the initial commit. For convenience, you can also add <code>.secrets</code> to the ‘global’ <code>.gitignore</code>. This is usually in your operating system’s ‘user’ folder, or you can open the global <code>.gitignore</code> in RStudio by running <code>usethis::edit_git_ignore()</code>. It is a good idea to also add <code>.secrets</code> to the repo’s <code>.gitignore</code>, for the benefit of any collaborators who might clone or fork your project.</p>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="configuring-aws-s3" class="level2">
<h2 class="anchored" data-anchor-id="configuring-aws-s3">Configuring AWS S3</h2>
<p>AWS Simple Storage Service (<a href="https://aws.amazon.com/s3/">Amazon S3</a>) is a high performing object storage service in the cloud. You can try it out at no cost for 12 months (up to 5GB) with a new AWS account (see <a href="https://aws.amazon.com/free">AWS Free Tier</a> for details). After that, you’re charged on a pay-as-you-go basis (which is still quite cheap for modest amounts of data).</p>
<p>The steps in setting up S3 to transfer data from R are listed below (you don’t have to do them in this exact order):</p>
<ol type="1">
<li>Create a new S3 bucket<br>
</li>
<li>Create ‘folders’ within the bucket (if desired)<br>
</li>
<li>Set permissions for the bucket folders to be “public” (if you want the files to be available to anyone) or “private”<br>
</li>
<li>Create a new IAM user<br>
</li>
<li>Create a ‘policy’ that gives the IAM user permissions to write to the bucket</li>
</ol>
<p>In the following example, we’ll set up a S3 bucket that has a public folder (for example for PNG files that you might want to use in a Shiny dashboard), and a private folder (e.g., for log files). We’ll then create an IAM account that we can use in R to transfer files to S3.</p>
<section id="create-a-new-s3-bucket" class="level3">
<h3 class="anchored" data-anchor-id="create-a-new-s3-bucket">1. Create a new S3 Bucket</h3>
<p>Log into AWS<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> using either your root credentials or an IAM account with administrative privileges (preferred).</p>
<p>Find your way to the <a href="https://s3.console.aws.amazon.com/s3/home">S3 console</a>, and click the ‘Create Bucket’ button.</p>
<p>Under ‘General Configuration’, select the region where most of your users are located, and give your bucket a unique name (across the entire AWS ecosystem!). Note that bucket names can <strong>not</strong> contain uppercase characters or underscores, but you can use hyphens (<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">more info</a>). A good way to make your bucket name globally unique is to add some random characters at the end.</p>
<p><img src="./images/s3_01_bucketname_740x350x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>In the ‘Object Ownership’ section, keep the default setting that disables ACLs (we won’t need them because we’ll be handling bucket permissions using Policies).</p>
<p><img src="./images/s3_02_object-ownership_796x290x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>Next, the ‘Block All Public Access’ setting allows you to quickly and permanently block public access to the bucket (overriding everything else). In our case, we want one of the folders in the bucket to be public, so blocking all access would be overkill. However we can keep the first two blocking options, which block public access via ACLs (which we’re not using).</p>
<p>An important note here is that unchecking “Block Public Access” does <strong>not</strong> mean your bucket is now public. Everything is still private by default. It just means you have the ability to create a Policy object that makes some or all of the bucket files public.</p>
<p><img src="./images/s3_03_block-public-access_796x700x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>The remaining settings on the bucket configuration page are up to you.</p>
<p><strong>Enabling Bucket Versioning</strong> - probably a good idea if you’ll be adding / updating files programmatically. If your script accidentally overwrites a file with garbage, you’ll be able to get the original back.</p>
<p><img src="./images/s3_04_bucket-versioning_790x230x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p><strong>Tags</strong> can help you track the costs of operations related to this bucket, which is probably a good idea so you can track the total costs of your Shiny app or website.</p>
<p><img src="./images/s3_05_tags_738x240x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>The <strong>Default Encryption</strong> is probably fine (unless your web assets are particularly sensitive). You can change it if you’d like.</p>
<p><img src="./images/s3_06_encryption_796x370x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>When you’re all done, click the ‘Create Bucket’ button. If your bucket name is not globally unique or uses illegal characters, you’ll be prompted to fix it. Aside from the bucket name, most of the other settings can be changed later.</p>
<p><br>
</p>
</section>
<section id="create-folders-in-your-bucket-optional" class="level3">
<h3 class="anchored" data-anchor-id="create-folders-in-your-bucket-optional">2. Create Folders in Your Bucket (optional)</h3>
<p>Folders are flexible and intuitive way to organize data. If your bucket will hold different kinds of files (e.g., images, reports, log files, data files), you might want to create folders to organize them. (You could also create separate buckets for each kind of data). Another reason you might want to use folders is if you have lots of files that have natural groupings, for example by year, project, or location. You might also use folders if you want some of the files to be public but others, or if there are files that should only be accessible by certain IAM users (i.e., scripts).</p>
<p>In this example, we’ll create a folder for the files that we want to be public (i.e., image files for our Shiny dashboard), and another folder for files that we want to keep private. To begin, find the bucket in the S3 dashboard and click on it to open it.</p>
<p><img src="./images/s3_06_bucket-opened_880x386x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>To add a folder, click on the ‘Create folder’ button. Here we’ve added folders for <code>images</code> (that will be public) and <code>db</code> for database files (that will <strong>not</strong> be public).</p>
<p><img src="./images/s3_07_folders_924x200x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<div class="callout callout-style-default callout-note callout-titled" title="Folders in S3">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Folders in S3
</div>
</div>
<div class="callout-body-container callout-body">
<p>‘Folders’ in a S3 bucket are not true directories like you have on your hard drive. Rather, they are more like parts of the file name that use a syntax inspired by paths in traditional file systems (i.e., a series of strings separated with forward slash characters <code>/</code>). Despite this ‘mimicry’, folders are still very useful for organizing your data, and supported by many of S3’s file management utilities.</p>
</div>
</div>
<p>Next, click on the Properties tab and find the Amazon Resource Name (ARN). An ARN a bit like a URL in the AWS universe, so save it as we’ll need it later. The ARN will look like:</p>
<div style="margin-left:2em;">
<p><code>arn:aws:s3:::my-webassets-test-etgimnq</code></p>
</div>
<p><br>
</p>
</section>
<section id="make-one-of-the-folders-public" class="level3">
<h3 class="anchored" data-anchor-id="make-one-of-the-folders-public">3. Make One of the Folders Public</h3>
<p>As of right now, nothing in the bucket is publicly accessible. Even though we told it to <em>not</em> to apply a blanket prohibition against public access when we set up the bucket, the default setting for S3 objects is private. In this step, we’ll create a Policy that makes one of the folders public, so web apps (including our Shiny app) can use the assets in that folder without the need to authenticate.</p>
<p>First, under the bucket ‘Permissions’, verify that ‘block all public access’ remains unchecked (which you set above ^^^), and that the last two options blocking the use of policies are also unchecked.</p>
<p><img src="./images/s3_08_block-public-access_924x266x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>Scroll down to Bucket policy, and click ‘Edit’. This is where we’ll create a Policy that will allow the objects (files) in the ‘images’ folder to be public. A Policy is like a permission slip that specifies who can do what in the very broadest sense.</p>
<p>In the Policy editor, paste the JSON code below, swapping in your own ARN for the ‘Resource’. <strong>Make sure there are no blank lines at the top</strong>. When done, click the orange ‘Save Changes’ button at the bottom.</p>
<div class="json-chunk">
<pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AddPerm",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::my-webassets-test-etgimnq/images/*"
        }
    ]
}</code></pre>
</div>
<p><br>
</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Files vs Folders">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Files vs Folders
</div>
</div>
<div class="callout-body-container callout-body">
<p>The details of constructing a JSON expression for a Policy are beyond the scope of this Tech Note, but there are lots of tutorials available.</p>
<p>An important detail we see above is the <code>"/*"</code> at the end of the ARN. This wildcard character means the “Allow GetObject” permission goes to the objects (i.e., files) inside that folder. The policy doesn’t assign any permissions to the folder itself (such as get a listing of the files), so the web app will need to know the full name of the file it wants.</p>
</div>
</div>
<p><br>
</p>
<p>To verify the policy works, go back to the ‘Objects’ tab, click into the ‘images’ folder (that you just made public), and upload a PNG file from your hard drive. After it’s uploaded, click on the file name to preview its properties. You’ll see the <strong>Object URL</strong>. Copy the object URL and paste it in another browser to verify the PNG file is actually open to the public.</p>
<p><img src="./images/s3_09_object-overview_924x414x256.png" class="screenshot img-fluid"></p>
<p><br>
For example, try opening:</p>
<div style="margin-left:2em;">
<p><a href="https://my-webassets-test-etgimnq.s3.us-west-1.amazonaws.com/images/myplot_300x300.png" class="uri">https://my-webassets-test-etgimnq.s3.us-west-1.amazonaws.com/images/myplot_300x300.png</a></p>
</div>
<p><br>
</p>
<p>We’re done with S3! (at least for now). Next we’ll create an IAM User Account that we can use in R, and give it permission to read and write to all folders in the bucket.</p>
<p><br>
</p>
</section>
<section id="create-an-iam-user" class="level3">
<h3 class="anchored" data-anchor-id="create-an-iam-user">4. Create an IAM User</h3>
<p>As noted above, you never want our script to authenticate using your main credentials (aka Root account). So to transfer files from to and from S3, next you’ll need to create an IAM account (the AWS equivalent of a Service Account).</p>
<p>Go to the IAM Control panel, and click ‘Create New User’. Enter a user name that will help you remember what this IAM account is intended for. IAM usernames can have up to 64 characters. Valid characters are: A-Z, a-z, 0-9, and + = , . @ _ - (hyphen). Unlike S3 bucket names, they do <em>not</em> have to be globally unique.</p>
<p><img src="./images/s3_10_user-details_922x236x256.png" class="screenshot img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled" title="AWS Management Console">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AWS Management Console
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note above how we have left “Provide user access to the AWS Management Console” <em>unchecked</em>. This is because we are creating this IAM User exclusively for programmatic access from R using the AWS API. In other words, we’ll never log into the AWS web portal with this IAM user, so there’s no need to give it access to the Console.</p>
</div>
</div>
<p><br>
</p>
<p>On the ‘Set permissions’ page, don’t assign any permissions. We’ll do that later. Just click ‘Next’. On the next screen, you can add a tag if you’d like (i.e., to help with billing). Otherwise, just click ‘Create user’.</p>
<p>Once the user is created, click on the name to sees it properties. The first thing to take note of is the ARN, which you should copy down:</p>
<p><img src="./images/s3_11_iam-summary_764x226x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
</section>
<section id="give-the-iam-user-permissions-to-your-bucket" class="level3">
<h3 class="anchored" data-anchor-id="give-the-iam-user-permissions-to-your-bucket">5. Give the IAM User permissions to your bucket</h3>
<p>Next, we’ll give the IAM User permissions to read and write files in the bucket. The key here is to give the IAM account the absolute minimum level of permissions. We could limit permissions to specific folders, but in this case we’ll grant permissions for the entire bucket because our R script will need to save files to both the “images” folder as well as the “db” folder.</p>
<p>On the Permissions policies tab, click on ‘Add permissions’ then ‘Create inline policy’.</p>
<p><img src="./images/s3_12_create-inline-policy_940x234x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>Click on the ‘JSON’ button to get to the Policy Editor, then copy-paste the following (changing the ARN’s to your own):</p>
<div class="json-chunk">
<pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor1",
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetBucketLocation"
            ],
            "Resource": "arn:aws:s3:::my-webassets-test-etgimnq"
        },
        {
            "Sid": "VisualEditor2",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::my-webassets-test-etgimnq/*"
        }
    ]
}</code></pre>
</div>
<p><br>
</p>
<p>This is a pretty narrow set of permissions. We are giving the IAM user just enough permissions to do what it needs to do in Shiny, and nothing more. Some notes about the JSON expression:</p>
<ul>
<li><p>one chunk of the JSON grants permissions to the bucket, and another chunk grants permissions to the objects in the bucket (because the __“/*“__ at the end)</p></li>
<li><p>the ARNs do not include any folder names, so the permissions are being applied to the entire bucket</p></li>
<li><p><code>s3:GetBucketLocation</code> allows the IAM user to verify the bucket exists (on the R side, this will be needed when we run <code>aws.s3::bucket_exists()</code>).</p></li>
<li><p><code>s3:ListBucket</code> allows the IAM user to list the objects in the bucket (in this case the entire bucket).</p></li>
<li><p><code>s3:PutObject</code>, <code>s3:GetObject</code>, <code>s3:DeleteObject</code> allows the user to add, read, and delete individual files in the bucket. Note also the resource for these permissions ends with the wildcard <code>/*</code></p></li>
</ul>
<p><br>
</p>
<p>Click ‘Next’. On the ‘Review and Create’ screen, give your policy a name that will help you remember what it allows. Then click ‘Create Policy’ when done.</p>
<p><img src="./images/s3_12_create-inline-policy_940x234x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>The IAM User account now has permissions to read and write files to the entire bucket. All that is left now is create security credentials so your script can authenticate.</p>
<p><br>
</p>
</section>
<section id="create-security-credentials" class="level3">
<h3 class="anchored" data-anchor-id="create-security-credentials">6. Create Security Credentials</h3>
<p>Click on the IAM User in the IAM Management Console to view its properties. Then click on the Security Credentials tab.</p>
<p>You can ignore the Console sign-in link, because we didn’t enable Console access above. Scroll down to the ‘Access keys’ section, and click the ‘Create access key’ button. The next screen asks what your use case is. Select ‘Application Running outside AWS’.</p>
<p><img src="./images/s3_14_security-credentials-use-case_954x682x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<p>After you select your use case, click ‘Next’. Enter a description which will help you remember what this access key is for, then click ‘Create access key’.</p>
<p>On the next screen, download your Access key and Secret access key as a CSV file record, or copy-paste them somewhere else. Treat these like a user name and password, and <strong>do not lose</strong> them (there is no way to recover the secret access key). Click Done.</p>
<p><img src="./images/s3_15_create-access-key_704x544x256.png" class="screenshot img-fluid"></p>
<p><br>
</p>
<div class="callout callout-style-default callout-caution callout-titled" title="IAM User Access Keys are Permanent!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
IAM User Access Keys are Permanent!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be aware that the Access Keys for your IAM User do not have an expiration date. This means they will last for a very long time, so you must be extremely careful not to let them get loose!</p>
</div>
</div>
<p><br>
</p>
<p>We are done setting up the IAM User Account. We can now start scripting!</p>
</section>
</section>
<section id="transfer-files-tofrom-s3-from-r" class="level2">
<h2 class="anchored" data-anchor-id="transfer-files-tofrom-s3-from-r">Transfer Files To/From S3 from R</h2>
<p>Finally, we get to write R code to transfer files to/from S3. There are at least two R packages that provide wrappers to the AWS S3 API, including <a href="https://github.com/cloudyr/aws.s3">aws.s3</a>, and <a href="https://www.paws-r-sdk.com/">paws</a>. Below we’ll use <code>aws.s3</code>. This is an older package, and it <a href="https://github.com/cloudyr/aws.s3/issues/433">may no longer be maintained</a>, but it still works for now.</p>
<section id="load-credentials" class="level3">
<h3 class="anchored" data-anchor-id="load-credentials">Load Credentials</h3>
<p>The first step is to load the access key and secret access key into R. Assuming you downloaded the keys as a CSV file (see above), and stored it in a sub-directory called <code>.screts</code> (see also above), you can load them into R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>my_keys_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./.secrets/iam-s3-manage-webassets_accessKeys.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>my_keys_df<span class="sc">$</span>Access.key.ID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AKIARESQK2QKYDNN4IA5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>my_keys_df<span class="sc">$</span>Secret.access.key <span class="sc">|&gt;</span> <span class="fu">nchar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40</code></pre>
</div>
</div>
<p>You could of course save them to disk as text or rds files, or save them as environment variables if that’s an option (which it isn’t on ShinyApps.io).</p>
<p>Next, following the <a href="https://github.com/cloudyr/aws.s3">documentation</a> from <code>aws.s3</code>, we store the keys as environment variables that the various functions in <code>aws.s3</code> will look for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="st">"AWS_ACCESS_KEY_ID"</span> <span class="ot">=</span> my_keys_df<span class="sc">$</span>Access.key.ID,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"AWS_SECRET_ACCESS_KEY"</span> <span class="ot">=</span> my_keys_df<span class="sc">$</span>Secret.access.key,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"AWS_DEFAULT_REGION"</span> <span class="ot">=</span> <span class="st">"us-west-1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
</section>
<section id="check-bucket" class="level3">
<h3 class="anchored" data-anchor-id="check-bucket">Check Bucket</h3>
<p>First, let’s check if our bucket exists. For this, we’ll need to construct the “S3 URI” for the bucket, which is simply <code>s3://</code> + <em>bucket name</em>. We’ll feed that into <code>bucket_exists()</code>, along with the region the bucket is located in:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aws.s3)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>s3_bucket_uri <span class="ot">&lt;-</span> <span class="st">"s3://my-webassets-test-etgimnq/"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>aws.s3<span class="sc">::</span><span class="fu">bucket_exists</span>(s3_bucket_uri, <span class="at">region =</span> <span class="st">"us-west-1"</span>) <span class="sc">|&gt;</span> <span class="fu">as.logical</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="download-and-upload-files" class="level3">
<h3 class="anchored" data-anchor-id="download-and-upload-files">Download and Upload Files</h3>
<p>To download a file from S3, we can use <code>get_object()</code> to bring it into memory, or <code>save_object()</code> to save it to disk.</p>
<p>Here, we’ll download a <a href="https://my-webassets-test-etgimnq.s3.us-west-1.amazonaws.com/images/cute-gerbil_300x300.jpg">JPG file</a> saved in the ‘<code>images</code>’ folder <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download and save the image</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>file_saved_fn <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">save_object</span>(<span class="at">object =</span> <span class="st">"images/cute-gerbil_300x300.jpg"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">bucket =</span> s3_bucket_uri,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">file =</span> <span class="st">"~cute-gerbil.jpg"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Display it</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(file_saved_fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="~cute-gerbil.jpg" class="img-fluid figure-img" width="150"></p>
</figure>
</div>
</div>
</div>
<p>Lastly, we’ll upload a file to S3:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a PNG file in the temp directory</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>temp_png <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".png"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(temp_png)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>), <span class="at">col =</span> <span class="fu">topo.colors</span>(<span class="dv">1000</span>), <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Upload it to S3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> temp_png,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">object =</span> <span class="fu">paste0</span>(<span class="st">"images/test_plot.png"</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bucket =</span> s3_bucket_uri)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p><br>
</p>
<p>Verify it worked:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download and save the test plot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>test_plot_fn <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">save_object</span>(<span class="at">object =</span> <span class="st">"images/test_plot.png"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">bucket =</span> s3_bucket_uri,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">file =</span> <span class="st">"~test_plot_downloaded_from_s3.png"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Display it</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(test_plot_fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="~test_plot_downloaded_from_s3.png" class="img-fluid figure-img" width="240"></p>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>AWS S3 provides fast, affordable cloud storage for R projects. This is particularly useful for Shiny apps hosted on ShinyApps.io, which doesn’t provide persistent storage across sessions. The steps we worked through to set this up include:</p>
<ol type="1">
<li>Creating an S3 bucket on AWS, and creating folders if needed.</li>
<li>Creating a Policy to make some of the folders publicly accessible (if needed for web apps).<br>
</li>
<li>Creating an IAM User that your R script can use to log in.<br>
</li>
<li>Creating a Policy that grants the IAM User permissions to read/write to the bucket.<br>
</li>
<li>Creating security credentials for the IAM User, and saving them in an external file.<br>
</li>
<li>Using functions from the <code>aws.s3</code> package to upload and download files from S3.</li>
</ol>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Although your AWS account and services may be connected to a specific region, you can log-in to the Console from the <a href="https://aws.amazon.com/">main AWS page</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This file is actually public to anyone with the <a href="https://my-webassets-test-etgimnq.s3.us-west-1.amazonaws.com/images/cute-gerbil_300x300.jpg">link</a>, so we could also get it with functions like <code>utils::download.file()</code><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->


<hr>

<p style="font-size:90%; font-style:italic; text-align:center;">This work was supported by the USDA - National Institute of Food and Agriculture (Hatch Project 1015742; Powers).</p>



<p style="margin-top:2em;"><img src="data:image/png;base64,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" style="width:550px; height:58px;"></p>

<p>&nbsp;</p>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>